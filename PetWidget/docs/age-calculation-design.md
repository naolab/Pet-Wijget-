# ペット年齢計算方法の設計

## 概要

ペットの実年齢を人間年齢に換算する新しい計算方法。
各動物種の成長特性（傾斜）を保持しつつ、平均寿命に応じて柔軟に計算できる設計。

## 基本コンセプト

**「平均寿命まで生きたら、人間の平均寿命（85歳）に到達する」**

- 動物種ごとの成長カーブ（傾斜）は固定
- 個体の平均寿命は調整可能（犬種、品種による違いに対応）
- すべての動物で統一的なロジック

## データ構造

### AgeConversionProfile（成長プロファイル）

各動物種の成長特性を定義する構造体。

```swift
struct AgeConversionProfile {
    /// 急成長期の割合（平均寿命に対する比率）
    /// 例：0.167 = 平均寿命の1/6が急成長期
    let earlyGrowthRatio: Double

    /// 急成長期終了時点の人間年齢
    /// 例：24歳（犬猫は2歳で人間の24歳相当）
    let earlyGrowthTarget: Double

    /// デフォルト平均寿命（年）
    let defaultLifespan: Double

    /// 人間の平均寿命（固定値）
    static let humanLifespan: Double = 85.0
}
```

## 計算式

### 基本ロジック

```swift
// 1. 急成長期の年数を計算
急成長期の年数 = 平均寿命 × earlyGrowthRatio

// 2. 実年齢が急成長期内か判定
if 実年齢 <= 急成長期の年数 {
    // 急成長期：線形で earlyGrowthTarget まで成長
    人間年齢 = (実年齢 / 急成長期の年数) × earlyGrowthTarget
} else {
    // 安定成長期：残りの人生で85歳まで成長
    残り年数 = 平均寿命 - 急成長期の年数
    残り人間年齢 = 85 - earlyGrowthTarget
    人間年齢 = earlyGrowthTarget + ((実年齢 - 急成長期の年数) / 残り年数) × 残り人間年齢
}
```

### 数式表現

```
急成長期（実年齢 ≤ L × r）:
  H = (A / (L × r)) × T

安定成長期（実年齢 > L × r）:
  H = T + ((A - L × r) / (L × (1 - r))) × (85 - T)

where:
  H = 人間年齢
  A = 実年齢
  L = 平均寿命
  r = earlyGrowthRatio
  T = earlyGrowthTarget
```

## 各動物種のプロファイル

### 犬（Dog）

```swift
earlyGrowthRatio: 0.167   // 平均寿命の1/6（約2年）
earlyGrowthTarget: 24     // 2歳で24歳相当
defaultLifespan: 12       // 平均寿命12年
```

**計算例（デフォルト平均寿命12年）：**
- 1歳 → 12歳
- 2歳 → 24歳
- 6歳 → 48歳
- 12歳 → 85歳 ✓

**計算例（小型犬、平均寿命15年）：**
- 2.5歳まで急成長 → 24歳
- 15歳 → 85歳 ✓

**計算例（大型犬、平均寿命10年）：**
- 1.67歳まで急成長 → 24歳
- 10歳 → 85歳 ✓

### 猫（Cat）

```swift
earlyGrowthRatio: 0.133   // 平均寿命の1/7.5（約2年）
earlyGrowthTarget: 24     // 2歳で24歳相当
defaultLifespan: 15       // 平均寿命15年
```

**計算例（平均寿命15年）：**
- 1歳 → 12歳
- 2歳 → 24歳
- 8歳 → 48歳
- 15歳 → 85歳 ✓

### 小動物（Small Animal - ハムスター、ウサギなど）

```swift
earlyGrowthRatio: 0.25    // 平均寿命の1/4
earlyGrowthTarget: 30     // 急成長で30歳相当
defaultLifespan: 4        // 平均寿命4年
```

**ウサギの計算例（平均寿命8年）：**
- 2歳まで急成長 → 30歳
- 8歳 → 85歳 ✓

**ハムスターの計算例（平均寿命2年）：**
- 0.5歳まで急成長 → 30歳
- 2歳 → 85歳 ✓

### 鳥（Bird）

```swift
earlyGrowthRatio: 0.2     // 平均寿命の1/5
earlyGrowthTarget: 28     // 急成長で28歳相当
defaultLifespan: 10       // 平均寿命10年
```

**セキセイインコの計算例（平均寿命7年）：**
- 1.4歳まで急成長 → 28歳
- 7歳 → 85歳 ✓

**オウムの計算例（平均寿命50年）：**
- 10歳まで急成長 → 28歳
- 50歳 → 85歳 ✓

### カメ（Turtle）

```swift
earlyGrowthRatio: 0.1     // 平均寿命の1/10
earlyGrowthTarget: 20     // 急成長で20歳相当
defaultLifespan: 30       // 平均寿命30年
```

**計算例（平均寿命30年）：**
- 3歳まで急成長 → 20歳
- 15歳 → 52歳
- 30歳 → 85歳 ✓

### 魚（Fish）

```swift
earlyGrowthRatio: 0.2     // 平均寿命の1/5
earlyGrowthTarget: 24     // 急成長で24歳相当
defaultLifespan: 5        // 平均寿命5年
```

**金魚の計算例（平均寿命10年）：**
- 2歳まで急成長 → 24歳
- 10歳 → 85歳 ✓

**熱帯魚の計算例（平均寿命3年）：**
- 0.6歳まで急成長 → 24歳
- 3歳 → 85歳 ✓

### 虫（Insect）

```swift
earlyGrowthRatio: 0.3     // 平均寿命の1/3
earlyGrowthTarget: 35     // 急成長で35歳相当
defaultLifespan: 1        // 平均寿命1年
```

**計算例（平均寿命1年）：**
- 0.3歳（約4ヶ月）まで急成長 → 35歳
- 1歳 → 85歳 ✓

### その他（Other）

```swift
earlyGrowthRatio: 0.2     // 平均寿命の1/5
earlyGrowthTarget: 25     // 急成長で25歳相当
defaultLifespan: 10       // 平均寿命10年
```

## 実装の利点

### 1. 統一的な計算ロジック
すべての動物種で同じ計算式を使用。コードの保守性が向上。

### 2. 柔軟な平均寿命設定
犬種、品種による寿命の違いを後から調整可能。

```swift
// 将来的な拡張例
let pet = Pet(
    name: "ポチ",
    species: .dog,
    customLifespan: 15.0  // 小型犬は15年
)
```

### 3. 直感的な理解
「平均寿命 = 人間の85歳」という分かりやすいコンセプト。

### 4. 成長カーブの保持
動物種ごとの成長特性（急成長期の存在）を正確に表現。

## 移行の影響

### 変更前後の比較（犬、平均寿命12年）

| 実年齢 | 旧計算 | 新計算 | 差分 |
|--------|--------|--------|------|
| 1歳    | 12歳   | 12歳   | ±0   |
| 2歳    | 24歳   | 24歳   | ±0   |
| 3歳    | 28歳   | 31歳   | +3   |
| 5歳    | 36歳   | 46歳   | +10  |
| 10歳   | 56歳   | 70歳   | +14  |
| 12歳   | 64歳   | 85歳   | +21  |

**変更理由：**
旧計算では12歳の犬が64歳にしかならず、平均寿命の概念が反映されていなかった。
新計算では平均寿命（12歳）で人間の平均寿命（85歳）に到達する。

## コード構造

```
Shared/
  Models/
    AgeConversionProfile.swift  (新規作成)
  Utilities/
    HumanAgeConverter.swift     (大幅改修)
```

## テストケース

各動物種で以下を確認：
1. 急成長期終了時点で `earlyGrowthTarget` に到達
2. 平均寿命到達時点で 85歳に到達
3. 平均寿命変更時も正しく計算される

## 今後の拡張

### Phase 1（今回実装）
- 動物種ごとの成長プロファイル定義
- 平均寿命ベースの計算ロジック実装

### Phase 2（将来的）
- Pet モデルに `customLifespan` プロパティ追加
- 設定画面で犬種選択（平均寿命プリセット）
- 品種ごとの平均寿命データベース

### Phase 3（将来的）
- 統計情報の表示（「同じ種類の平均より若い/年上」など）
- 健康状態による補正機能
