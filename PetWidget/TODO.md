# TODO: PetWidget 改善項目

## 1. 誕生日設定UIの改善

### 概要
ペット編集・追加画面の誕生日設定において、月表示が英語でわかりづらい問題を解決。日本人にもわかりやすく、かつユニバーサルな表示にする。

### 現状
- `DatePicker`の月表示が英語（January, February...）
- 日本語環境でも英語表記のため直感的でない

### 改善案
- ロケールに応じた月表示（日本語環境では「1月」「2月」...）
- `DatePicker`の`.environment(\.locale, Locale(identifier: "ja_JP"))`設定
- または`.datePickerStyle(.wheel)`でホイールスタイルに変更

### 実装難易度
**★☆☆☆☆ (非常に簡単)**
- SwiftUIの`DatePicker`に`.environment(\.locale, Locale.current)`を追加するだけ
- 既存のDatePickerコンポーネントの修正のみで対応可能
- テストも容易

---

## 2. 区切り線の表示制御

### 概要
ウィジェット内の時刻表示と名前表示の間の区切り線について、表示/非表示の切り替え機能を追加。特に時刻・日付が非表示の場合は線も非表示にする。

### 現状
- 時刻と名前の間に常に区切り線が表示されている
- 時刻・日付非表示時でも線が残る

### 改善案
1. 設定画面に「区切り線を表示」トグルを追加
2. 時刻・日付が両方非表示の場合は自動的に線を非表示
3. `DisplaySettings`に`showDivider: Bool`プロパティを追加

### 実装難易度
**★★☆☆☆ (簡単)**
- `DisplaySettings`モデルへのプロパティ追加
- 設定画面へのToggleコントロール追加
- ウィジェットビューでの条件分岐追加
- 既存の設定システムを活用できる

---

## 3. 表示項目のレイアウト位置調整

### 概要
各種表示項目（名前、年齢、時刻など）の配置を自由にカスタマイズできるようにする。

### 改善案

#### Phase 1: テキストアライメント設定（基本）
- 左寄せ、中央寄せ、右寄せの選択
- 設定画面でピッカーまたはセグメントコントロールで選択
- `DisplaySettings`に`textAlignment: TextAlignment`を追加

**実装難易度: ★★☆☆☆ (簡単)**
- SwiftUIの`.multilineTextAlignment()`を適用するだけ
- 設定UIの追加とモデル更新のみ

#### Phase 2: 数値指定による詳細配置
- X座標、Y座標のオフセット値を数値で指定
- 各要素ごとにオフセット値を持つ
- プレビュー画面で結果を確認しながら調整

**実装難易度: ★★★☆☆ (中程度)**
- 各要素ごとの位置設定データ構造の設計
- 設定UIの複雑化（スライダーや数値入力フィールド）
- ウィジェットサイズごとの制約処理が必要

#### Phase 3: ドラッグ&ドロップによる自由配置（理想）
- プレビュー画面で各要素をドラッグして配置
- リアルタイムでレイアウト変更を確認
- 位置情報を保存して実際のウィジェットに反映

**実装難易度: ★★★★★ (非常に難しい)**
- インタラクティブなレイアウトエディタの実装
- `DragGesture`を使った位置制御システム
- ウィジェットサイズごとのレイアウト管理
- スナップ機能、グリッド表示などのUX向上機能
- 要素間の重なり順序（z-index）管理
- ウィジェット実装との同期機構
- 開発工数: 2-3週間程度

### 推奨アプローチ
Phase 1から段階的に実装し、ユーザーフィードバックを得ながら進める。

---

## 4. 複数ウィジェットでの個別ペット表示

### 概要
複数のウィジェットを配置した際に、それぞれ異なるペットを表示できるようにする。

### 現状
- ウィジェットの設定が共有されている
- 複数配置しても同じペットが表示される可能性が高い

### 改善案

#### アプローチ1: ウィジェット Configuration の活用
- `IntentConfiguration`を使用してウィジェットごとに設定を持たせる
- ウィジェット追加時にペットを選択できるようにする
- Intents Definition (.intentdefinition) ファイルの作成が必要

**実装難易度: ★★★★☆ (難しい)**
- App Intents / Intents framework の理解が必要
- `.intentdefinition`ファイルの作成と設定
- Intent Extension の実装
- 動的なペット選択リストの生成
- ウィジェットごとの設定永続化
- iOS 14以降で利用可能な機能

#### アプローチ2: ウィジェットファミリーごとの表示分け
- Small: 最初のペット
- Medium: 2番目のペット（または2匹表示）
- Large: 複数ペット表示
- 簡易的な回避策だが、柔軟性に欠ける

**実装難易度: ★★☆☆☆ (簡単)**
- 既存コードの条件分岐追加のみ
- ただし、ユーザーが望む解決策ではない可能性が高い

### 推奨アプローチ
**アプローチ1（Intent Configuration）を推奨**
- ユーザー体験が最も優れている
- App Store の他のウィジェットアプリと同等の機能
- 一度実装すれば、今後の拡張性も高い

### 実装ステップ
1. Intents Definition ファイルを作成
2. Pet選択用のDynamic Optionsを実装
3. IntentTimelineProviderを実装
4. ウィジェット設定画面の実装
5. 既存のStaticConfigurationからIntentConfigurationへ移行

### 参考資料
- [Making a Configurable Widget](https://developer.apple.com/documentation/widgetkit/making-a-configurable-widget)
- [WidgetKit Intent Configuration](https://developer.apple.com/documentation/widgetkit/intentconfiguration)

---

## 優先度と実装順序の推奨

### 高優先度（すぐに実装可能 & 効果大）
1. **誕生日設定UIの改善** (難易度: ★☆☆☆☆)
   - 即座に実装可能
   - ユーザビリティが大幅に向上

2. **区切り線の表示制御** (難易度: ★★☆☆☆)
   - 短時間で実装可能
   - カスタマイズ性の向上

### 中優先度（機能として重要）
3. **表示項目の配置調整 - Phase 1** (難易度: ★★☆☆☆)
   - テキストアライメントのみ実装
   - 比較的簡単に実装できてユーザーの満足度が高い

4. **複数ウィジェット対応** (難易度: ★★★★☆)
   - 複数ペット飼育者には必須機能
   - 実装に時間がかかるが価値は高い

### 低優先度（理想の実装）
5. **表示項目の配置調整 - Phase 2/3** (難易度: ★★★★★)
   - 工数が大きい割に利用ユーザーは限定的
   - まずは簡易版で様子を見る

---

## 見積もり

### 最小限の改善（1-2日）
- 誕生日UI改善
- 区切り線制御

### 標準的な改善（3-5日）
- 上記 + テキストアライメント設定

### フル機能実装（2-3週間）
- 上記 + 複数ウィジェット対応 + ドラッグ&ドロップレイアウト

---

最終更新: 2025-10-17
